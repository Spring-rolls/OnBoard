<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>OnBoard - Profile</title>
    <link rel="shortcut icon" href="https://logomakercdn.truic.com/ux-flow/industry/board-game-lounge-meta.png" type="image/x-icon">
<!--    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">-->

    <link rel="stylesheet" href="/styles/reset.css" />
    <link rel="stylesheet" href="/styles/profile.css" />

<!--                <link rel="stylesheet" href="/static/styles/reset.css" />-->
<!--                <link rel="stylesheet" href="/static/styles/profile.css" />-->

    <script src="https://kit.fontawesome.com/1599d6604b.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/styles/ballNoticfication.css" />


</head>
<body>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <a class="navbar-brand" href="/"> <img src="https://logomakercdn.truic.com/ux-flow/industry/board-game-lounge-meta.png"  >OnBoard</a>
        </div>
        <div class="dropdown">
            <span class="dropbtn">Menu<i id="this" class="fas fa-sort-down"></i></span>
            <ul class="nav navbar-nav navbar-right dropdown-content">
                <li ><a  href="/" >Home</a></li>
                <li ><a th:if="${authUser}" th:href="${'/profile'}" >profile</a></li>
                <li ><a  href="/aboutus" >About Us</a></li>
                <li ></li>
                <!--            <li sec:authorize="!isAuthenticated()"><a href="/signupNormal" ><span class="glyphicon glyphicon-user"></span> Sign Up Normal</a></li>-->
                <li sec:authorize="!isAuthenticated()"><a href="/login"  ><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                <li sec:authorize="!isAuthenticated()"><a href="/signup" ><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                <li ><p  id="text"></li>
                <li sec:authorize="isAuthenticated()"><a href="/perform_logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
            </ul>
        </div>
        <div class="ball">
            <div class = "icons">
                <div class = "notification">
                    <div class = "notBtn" >
                        <i class="fas fa-bell"></i>
                        <div class = "box">
                            <div class = "display">
                                <div class = "cont">
                                    <div th:each="event:${authUser.getEventList()}">
                                        <div class = "sec new" th:each="userJoin:${event.getApplicationUserList()}">
                                            <div class = "profCont">
                                                <img class = "profile" th:src="${userJoin.getImage()}" >
                                            </div>
                                            <div class = "txt"> <p th:text="${userJoin.getFirstName()+ ' has joined to '+event.getGameName()  + ' event' }" ></p></div>
                                            <div class = "txt sub">11/7 - 2:30 pm</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a th:href="${'/profile'}"><img th:if="${authUser}" th:src="${authUser.getImage()}" class="img"></a>
        <img sec:authorize="!isFullyAuthenticated()" src="https://www.iconpacks.net/icons/2/free-user-icon-3296-thumb.png" class="img" style="filter: invert(1);">
        <a  class="a" sec:authorize="!isFullyAuthenticated()" href="/login">Login</a>
        <a class="a"  sec:authorize="isFullyAuthenticated()" href="/perform_logout">Logout</a>
    </div>
</nav>

<div id="banner">

</div>



<div id="info" th:if="${authUser}">
<img th:src="${authUser.getImage()}" class="avatar">
    <div id="ps">
<p th:text="'Name: ' +${authUser.getFirstName()} +' '+${authUser.getLastName()}"> </p>
<p th:text="'Account Type: ' + ${authUser.getUserType()}"> </p>
<p th:if="${authUser.getUserType() == 'business'}" th:text="'Location: ' +${authUser.getLocation()}"> </p>
<p th:if="${authUser.getUserType() == 'business'}" th:text="'Business Name: ' +${authUser.getPlaceName()}"> </p>
<p th:if="${authUser.getUserType() == 'business'}" th:text="'Working Hours: ' +${authUser.getWorkingHour()}"> </p>
<!--        <div th:if="${authUser.starRate() != 'NaN'}" class="gg">-->
<!--            <i   style="color: yellow; font-size: 4pc" class="fas fa-star"></i><span style="position: absolute; top:1.5rem; left:1.3rem;" th:text="${authUser.starRate()}"></span>-->
<!--        </div >-->
        <a th:if="${authUser}" th:href="${'/editProfileUser'}" >Update Info</a>
    </div>

</div>


<div id="notify">

    <p id="gg">Events Log</p>
            <div id="not"  th:if="${authUser}"  th:each="note:${authUser.getNotifications()}">
                <p th:text="${note.getNotification()}"></p>
            </div>

</div>



<main>
    <hr>
    <h1>Hosted Events</h1>
    <div th:if="${authUser.getUserType() == 'normal'}">
        <div class="hosting">
        <div class="event" th:each="event:${authUser.getEventList()}">
            <p th:text="'Game: '+${event.getGameName()}"></p>

            <p th:text="'On '+${event.getDateTime()}"></p>
            <p th:text="'Place '+${event.getPlace()}"></p>
<!--            <p th:text="${'joined player '+(event.getApplicationUserList().size()+1)}"> </p>-->
            <p ><span>Status: </span><span style="color: green" th:id="${event.getId()+'h'}"> OPEN </span></p>

            <div th:if="${(event.getApplicationUserList().size()+1)>=event.getNumberOfPlayer()}">
            <h2> the event is ready </h2>
            </div>
            <span th:text="${(event.getApplicationUserList().size()+1)}+'/'+${event.getNumberOfPlayer()}"> </span><br>
            <a href="#" class="btn btn-danger" th:href="@{/deleted/{id}(id=${event.getId()})}">Delete</a>
            <a href="#" class="btn btn-primary" th:href="@{/updatefromprofile/{id}(id=${event.getId()})}">Edit</a>
        </div>
      </div>
    </div>

     <div th:if="${authUser.getUserType() == 'business'}">
        <div class="hosting" style="width: 100%">
          <div class="event" th:each="event:${authUser.getEventList()}">
            <p th:text="'gameName '+${event.getGameName()}"></p>
            <p th:text="'Description '+${event.getDescription()}"></p>
            <p th:text="'DateTime '+${event.getDateTime()}"></p>
              <p ><span>Status: </span><span style="color: green" th:id="${event.getId()+'h'}"> OPEN </span></p>
            <p th:text="'Place '+${event.getPlace()}"></p>
            <span th:text="'Votes '+${event.getNumberOfPlayer()}"> </span><br>
            <a  href="#" class="btn btn-primary" th:href="@{/updatefromprofile/{id}(id=${event.getId()})}">Edit</a>
            <a href="#" class="btn btn-danger" th:href="@{/deleted/{id}(id=${event.getId()})}">Delete</a>
          </div>
        </div>
    </div>



    <h1  style="position: absolute; top:59.5rem; left: 48rem" th:if="${authUser.getUserType() == 'normal'}">Joined and Upvoted Events</h1>
    <div th:if="!${authUser.getUserType() == 'business'}" id="joining">
    <div class="event" th:each="event:${authUser.getEvents()}">
        <div th:if="${event.getApplicationUser().getUserType() == 'normal'}">
            <img th:src="${event.getApplicationUser().getImage()}" class="img">
            <p th:text="${event.getApplicationUser().getFirstName()}"></p>
            <p th:text="'Game: '+${event.getGameName()}"></p>
<!--            <p th:text="'NumberOfPlayer '+${event.getNumberOfPlayer()}"></p>-->
            <p th:text="'On '+${event.getDateTime()}"></p>
            <p th:id="${event.getId()}"></p>
            <p th:text="'Place: '+${event.getPlace()}"></p>

            <div th:if="${authUser}">
                <span th:text="${(event.getApplicationUserList().size()+1)}+'/'+${event.getNumberOfPlayer()}"> </span><br>
                <div th:if="!${event.getApplicationUser() == authUser}">
                    <a th:if="${authUser.getEvents().contains(event)}" href="#" class="btn btn-primary" th:href="@{/unjoins/{id}(id=${event.getId()})}">unjoin</a>
                </div>
            </div>
        </div>
        <div th:if="${event.getApplicationUser().getUserType() == 'business'}">
            <img th:src="${event.getApplicationUser().getImage()}" class="img">
            <p th:text="${event.getApplicationUser().getFirstName()}"></p>
            <p th:text="'Game: '+${event.getGameName()}"></p>
            <p th:text="'Description '+${event.getDescription()}"></p>
            <p th:text="'On '+${event.getDateTime()}"></p>
            <p th:id="${event.getId()}" ></p>
            <p th:text="'Place: '+${event.getPlace()}"></p>
            <span th:text="'Votes '+${event.getNumberOfPlayer()}"> </span><br>
            <div th:if="${authUser}">

                <div th:if="!${event.getApplicationUser() == authUser}">
                    <a th:if="${authUser.getEvents().contains(event)}" href="#" class="btn btn-primary" th:href="@{/unjoins/{id}(id=${event.getId()})}">Down-vote</a>
                </div>
            </div>
        </div>
    </div>
    </div>

</main>



<hr id="imp">

<!--<hr id="divider">-->

<footer>


    &nbsp;

    <a class="navbar-brand" href="/"> <img src="https://logomakercdn.truic.com/ux-flow/industry/board-game-lounge-meta.png"  >OnBoard</a><br>
    <div id="rit"><span id="rights"> All rights reserved for OnBoard  <i class="far fa-copyright"></i> 2021</span></div>
</footer>

<script th:inline="javascript" th:each="event:${authUser.getEventList()}">
/*<![CDATA[*/
    var message = /*[[${event.getDateTime()}]]*/ 'default';
    console.log(message);
    var id = /*[[${(event.getId()).toString()}]]*/ 'default';
console.log(id)
/*]]>*/

var countDownDate = new Date(message).getTime();
 var now = new Date().getTime();
 if(now>countDownDate){
    document.getElementById(id+'h').innerHTML = "EXPIRED";
    document.getElementById(id+'h').style.color="red";

}
</script>

<script th:inline="javascript" th:each="event:${authUser.getEvents()}">
/*<![CDATA[*/
    var message = /*[[${event.getDateTime()}]]*/ 'default';
    console.log(message);
    var id = /*[[${(event.getId()).toString()}]]*/ 'default';
console.log(id)
/*]]>*/

var countDownDate = new Date(message).getTime();
 var now = new Date().getTime();
 if(now>countDownDate){
document.getElementById(id).parentElement.remove();
}
</script>

</body>
</html>

